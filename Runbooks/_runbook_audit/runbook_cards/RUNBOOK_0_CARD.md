## Purpose
This document is the **canonical specification** for the FACTSWAY Legal Drafting Engine. Every subsequent runbook must comply with the contracts defined here. No implementation decisions should be made that contradict this document.

**Audience:** Claude Code (for building), Human (for verification)

**Status:** LOCKED - Do not modify during build phase

---

## Produces (Artifacts)
```typescript
interface ParsedDocument {
  // Raw extraction
  raw_text: string;
  
  // Structured components
  case_block: {
    court_line: string;
    judicial_district?: string;
    cause_number: string;
    party_block_raw: string;
    motion_title: string;
    salutation: string;
  };
  
  // Parsed case data
  suggested_case_data: Partial<Case>;
  
  // Body
  body_start_line: number;
  body_end_line: number;
  body_content: string;             // As HTML
  body_sections: SectionNode[];     // Parsed hierarchy
  
  // Signature
  signature_ooxml: string;
  signature_start_line: number;
  
  // Certificate (if present)
  certificate_ooxml?: string;
  certificate_start_line?: number;
}
```

## Consumes (Prereqs)
UNSPECIFIED
TODO: Provide details (00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1-L15528)

## Interfaces Touched
- REST endpoints
  - POST /facts/parse (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1112-L1112) "2. Call Facts Service (`POST /facts/parse`) to get sentence IDs"
  - PUT /drafts/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1115-L1115) "5. POST to Records Service (`PUT /drafts/{id}`)"
  - GET /drafts/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1118-L1118) "1. GET from Records Service (`GET /drafts/{id}`)"
  - POST /ingest (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6489-L6489) "### 10.1 POST /ingest"
  - POST /export (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6516-L6516) "### 10.2 POST /export"
  - POST /preview (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6608-L6608) "### 10.3 POST /preview"
  - GET /health (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6681-L6681) "### 10.4 GET /health"
  - POST /templates (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11352-L11352) "- [ ] `POST /templates` creates template, returns UUID"
  - GET /templates/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11353-L11353) "- [ ] `GET /templates/{id}` retrieves template"
  - PUT /templates/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11354-L11354) "- [ ] `PUT /templates/{id}` updates template"
  - DELETE /templates/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11355-L11355) "- [ ] `DELETE /templates/{id}` soft-deletes template"
  - POST /ingest (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11360-L11360) "- [ ] `POST /ingest` accepts .docx file"
  - POST /export (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11366-L11366) "- [ ] `POST /export` accepts LegalDocument"
  - POST /caseblock/extract (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11375-L11375) "- [ ] `POST /caseblock/extract` accepts raw OOXML"
  - POST /caseblock/format (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11377-L11377) "- [ ] `POST /caseblock/format` accepts CaseCaption"
  - POST /signature/extract (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11381-L11381) "- [ ] `POST /signature/extract` accepts raw OOXML"
  - POST /signature/format (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11383-L11383) "- [ ] `POST /signature/format` accepts SignatureBlock"
  - POST /facts/parse (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11387-L11387) "- [ ] `POST /facts/parse` accepts paragraph text"
  - GET /facts/sentences/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11392-L11392) "- [ ] `GET /facts/sentences/{id}` retrieves sentence by ID"
  - POST /exhibits (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11395-L11395) "- [ ] `POST /exhibits` uploads file, returns Exhibit with UUID"
  - GET /exhibits/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11396-L11396) "- [ ] `GET /exhibits/{id}` retrieves exhibit metadata"
  - POST /exhibits/appendix (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11397-L11397) "- [ ] `POST /exhibits/appendix` generates exhibit appendix OOXML"
  - POST /caselaw/detect (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11402-L11402) "- [ ] `POST /caselaw/detect` accepts paragraph text"
  - POST /caselaw/link (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11405-L11405) "- [ ] `POST /caselaw/link` accepts citation + opinion file, returns CaselawCitation"
- IPC channels/events (if any)
  - | Runbook | Service | Port | Produces | Depends On | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L184-L184) "| Runbook | Service | Port | Produces | Depends On |"
  - - Facts Service (port 3006) is authoritative for sentence registry (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L313-L313) "- Facts Service (port 3006) is authoritative for sentence registry"
  - python main.py  # Runs on assigned port (e.g., 3001) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L348-L348) "python main.py # Runs on assigned port (e.g., 3001)"
  - ├── Records Service (port 3001) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L434-L434) "├── Records Service (port 3001)"
  - ├── Ingestion Service (port 3002) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L436-L436) "├── Ingestion Service (port 3002)"
  - ├── Export Service (port 3003) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L438-L438) "├── Export Service (port 3003)"
  - ├── CaseBlock Service (port 3004) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L440-L440) "├── CaseBlock Service (port 3004)"
  - ├── Signature Service (port 3005) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L442-L442) "├── Signature Service (port 3005)"
  - ├── Facts Service (port 3006) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L444-L444) "├── Facts Service (port 3006)"
  - ├── Exhibits Service (port 3007) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L446-L446) "├── Exhibits Service (port 3007)"
  - └── Caselaw Service (port 3008) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L448-L448) "└── Caselaw Service (port 3008)"
  - // Case Block Data (from CaseBlock Service, port 3004) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3132-L3132) "// Case Block Data (from CaseBlock Service, port 3004)"
  - // Signature Block Data (from Signature Service, port 3005) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3135-L3135) "// Signature Block Data (from Signature Service, port 3005)"
  - // Computed Metadata (from Facts Service, port 3006) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3146-L3146) "// Computed Metadata (from Facts Service, port 3006)"
  - // Exhibits (from Exhibits Service, port 3007) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3233-L3233) "// Exhibits (from Exhibits Service, port 3007)"
  - // Caselaw Citations (from Caselaw Service, port 3008) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3259-L3259) "// Caselaw Citations (from Caselaw Service, port 3008)"
  - // Statute Citations (from Caselaw Service, port 3008) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3285-L3285) "// Statute Citations (from Caselaw Service, port 3008)"
  - // Export Configuration (for Export Service, port 3003) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3308-L3308) "// Export Configuration (for Export Service, port 3003)"
  - 4. Update all services to handle missing field gracefully (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3460-L3460) "4. Update all services to handle missing field gracefully"
  - // Future: handle other citation types (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4404-L4404) "// Future: handle other citation types"
  - onKeyDown: (props) => { /* handle navigation */ }, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L5172-L5172) "onKeyDown: (props) => { /* handle navigation */ },"
  - | Ctrl+N | New window | New draft | Do NOT prevent—let browser handle. Use toolbar for new draft. | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7037-L7037) "| Ctrl+N | New window | New draft | Do NOT prevent—let browser handle. Use toolbar for new draft. |"
  - | Ctrl+O | Open file | Open draft | Do NOT prevent—let browser handle. Use toolbar for open. | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7038-L7038) "| Ctrl+O | Open file | Open draft | Do NOT prevent—let browser handle. Use toolbar for open. |"
  - const channel = new BroadcastChannel('factsway_editor'); (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7124-L7124) "const channel = new BroadcastChannel('factsway_editor');"
  - channel.postMessage({ type: 'DRAFT_OPENED', draftId: currentDraftId }); (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7127-L7127) "channel.postMessage({ type: 'DRAFT_OPENED', draftId: currentDraftId });"
  - channel.onmessage = (event) => { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7130-L7130) "channel.onmessage = (event) => {"
  - channel.postMessage({ type: 'DRAFT_CLOSED', draftId: currentDraftId }); (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7155-L7155) "channel.postMessage({ type: 'DRAFT_CLOSED', draftId: currentDraftId });"
  - While Pandoc 3.6.1+ can handle data URIs natively, preprocessing provides: (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9094-L9094) "While Pandoc 3.6.1+ can handle data URIs natively, preprocessing provides:"
  - # Log errors but continue - Pandoc will handle gracefully (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9198-L9198) "# Log errors but continue - Pandoc will handle gracefully"
  - **Records Service (port 3001)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10031-L10031) "**Records Service (port 3001)**"
  - PORT=3001 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10053-L10053) "PORT=3001"
  - **CaseBlock Service (port 3004)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10060-L10060) "**CaseBlock Service (port 3004)**"
  - PORT=3004 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10079-L10079) "PORT=3004"
  - **Signature Service (port 3005)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10087-L10087) "**Signature Service (port 3005)**"
  - **Facts Service (port 3006)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10105-L10105) "**Facts Service (port 3006)**"
  - **Exhibits Service (port 3007)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10123-L10123) "**Exhibits Service (port 3007)**"
  - **Caselaw Service (port 3008)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10141-L10141) "**Caselaw Service (port 3008)**"
  - **Ingestion Service (port 3002)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10162-L10162) "**Ingestion Service (port 3002)**"
  - PORT=3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10183-L10183) "PORT=3002"
  - **Export Service (port 3003)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10190-L10190) "**Export Service (port 3003)**"
  - PORT=3003 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10210-L10210) "PORT=3003"
  - port: number; (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10257-L10257) "port: number;"
  - port: 3001, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10268-L10268) "port: 3001,"
  - PORT: '3001', (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10270-L10270) "PORT: '3001',"
  - port: 3002, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10281-L10281) "port: 3002,"
  - PORT: '3002', (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10283-L10283) "PORT: '3002',"
  - port: 3003, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10294-L10294) "port: 3003,"
  - PORT: '3003', (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10296-L10296) "PORT: '3003',"
  - // Handle crashes (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10408-L10408) "// Handle crashes"
  - // Handle spawn errors (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10421-L10421) "// Handle spawn errors"
  - this.waitForServiceHealth(service.name, service.port) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10456-L10456) "this.waitForServiceHealth(service.name, service.port)"
  - private async waitForServiceHealth(name: string, port: number): Promise<void> { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10465-L10465) "private async waitForServiceHealth(name: string, port: number): Promise<void> {"
  - const url = `http://localhost:${port}/health`; (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10466-L10466) "const url = `http://localhost:${port}/health`;"
  - // Handle hard crashes (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10552-L10552) "// Handle hard crashes"
  - - [ ] `curl localhost:{port}/health` returns 200 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11333-L11333) "- [ ] `curl localhost:{port}/health` returns 200"
  - **Runbook 3: Records Service (port 3001)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11351-L11351) "**Runbook 3: Records Service (port 3001)**"
  - **Runbook 4: Ingestion Service (port 3002)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11359-L11359) "**Runbook 4: Ingestion Service (port 3002)**"
  - **Runbook 5: Export Service (port 3003)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11365-L11365) "**Runbook 5: Export Service (port 3003)**"
  - **Runbook 6: CaseBlock Service (port 3004)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11374-L11374) "**Runbook 6: CaseBlock Service (port 3004)**"
  - **Runbook 7: Signature Service (port 3005)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11380-L11380) "**Runbook 7: Signature Service (port 3005)**"
  - **Runbook 8: Facts Service (port 3006)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11386-L11386) "**Runbook 8: Facts Service (port 3006)**"
  - **Runbook 9: Exhibits Service (port 3007)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11394-L11394) "**Runbook 9: Exhibits Service (port 3007)**"
  - **Runbook 10: Caselaw Service (port 3008)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11401-L11401) "**Runbook 10: Caselaw Service (port 3008)**"
  - **Pitfall 4: Service Port Conflicts** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11434-L11434) "**Pitfall 4: Service Port Conflicts**"
  - - **Cause:** Port collision between services (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11436-L11436) "- **Cause:** Port collision between services"
  - - [ ] Services use localhost:{port} (no Docker) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11492-L11492) "- [ ] Services use localhost:{port} (no Docker)"
  - - [ ] All service port numbers match Section 1.2 diagram (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11539-L11539) "- [ ] All service port numbers match Section 1.2 diagram"
  - 1. IDLE: Drag handle visible on hover (⠿ icon) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L12865-L12865) "1. IDLE: Drag handle visible on hover (⠿ icon)"
  - │ ⠿ I. INTRODUCTION       │  ← Drag handle on hover (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13599-L13599) "│ ⠿ I. INTRODUCTION │ ← Drag handle on hover"
  - .outline-item .drag-handle { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13636-L13636) ".outline-item .drag-handle {"
  - .outline-item:hover .drag-handle { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13642-L13642) ".outline-item:hover .drag-handle {"
  - This prevents "Port 3001 already in use" errors after crashes. (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14485-L14485) "This prevents "Port 3001 already in use" errors after crashes."
  - - name: PORT (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14542-L14542) "- name: PORT"
  - port: 3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14563-L14563) "port: 3002"
  - port: 3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14569-L14569) "port: 3002"
  - port: 3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14583-L14583) "port: 3002"
  - port: parseInt(process.env.PORT || '3001'), (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14768-L14768) "port: parseInt(process.env.PORT || '3001'),"
  - port: int = int(os.getenv('PORT', '3002')) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14811-L14811) "port: int = int(os.getenv('PORT', '3002'))"
  - PORT: service.port.toString(), (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14857-L14857) "PORT: service.port.toString(),"
  - - name: PORT (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14928-L14928) "- name: PORT"
  - port: config.port, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14953-L14953) "port: config.port,"
  - "port": 3002, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14984-L14984) ""port": 3002,"
  - **No Docker requirement for end users. No zombie processes. No port conflicts.** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15174-L15174) "**No Docker requirement for end users. No zombie processes. No port conflicts.**"
- Filesystem paths/formats
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L179-L179) "| 2 | Document Processing Core | OOXML generators, Pandoc wrapper, reference.docx | 0, 1 |"
  - requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L347-L347) "pip install -r requirements.txt"
  - docker-compose.test.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L373-L373) "docker-compose -f docker-compose.test.yml up --abort-on-container-exit"
  - api-spec.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L393-L393) "1. Define endpoint in `api-spec.yaml` (Section 11)"
  - motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L519-L519) "- Upload motion.docx in browser"
  - response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L593-L593) "const result = await response.json();"
  - response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L608-L608) "const result = await response.json();"
  - smith_v_jones_opinion.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L897-L897) "name: string; // "smith_v_jones_opinion.pdf""
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1100-L1100) "│ file_path: "/uploads/contract.pdf" │"
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1275-L1275) "{ id: 'ev-001', label: 'A', file_path: '/uploads/contract.pdf' }"
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3241-L3241) "file_name: string; // "contract.pdf""
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3242-L3242) "file_path: string; // "/uploads/{case_id}/exhibits/contract.pdf""
  - smith_v_jones.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3278-L3278) "opinion_file_path?: string; // "/uploads/{case_id}/opinions/smith_v_jones.pdf""
  - cprc_41.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3301-L3301) "statute_file_path?: string; // "/uploads/{case_id}/statutes/cprc_41.pdf""
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4476-L4476) "│ contract.pdf (245 KB) │"
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4545-L4545) "│ │ ○ Exhibit A - Signed Contract (contract.pdf) │ │"
  - emails.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4546-L4546) "│ │ ○ Exhibit B - Email Correspondence (emails.pdf) │ │"
  - invoice.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4547-L4547) "│ │ ○ Exhibit C - Invoice #1234 (invoice.pdf) │ │"
  - smith_v_jones.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4799-L4799) "│ ○ Smith v. Jones opinion (smith_v_jones.pdf) │"
  - doe_v_state.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4800-L4800) "│ ○ Doe v. State opinion (doe_v_state.pdf) │"
  - original.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6408-L6408) "doc = Document("original.docx")"
  - exported.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6419-L6419) "new_doc.save("exported.docx")"
  - exported.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6422-L6422) "reloaded = Document("exported.docx")"
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7173-L7173) "│ │ contract.pdf • 245 KB │ │"
  - emails.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7175-L7175) "│ │ emails.pdf • 1.2 MB │ │"
  - invoice.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7177-L7177) "│ │ invoice.pdf • 89 KB │ │"
  - opinion.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7184-L7184) "│ │ 123 S.W.3d 456 • opinion.pdf │ │"
  - doe_opinion.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7186-L7186) "│ │ 456 S.W.3d 789 • doe_opinion.pdf │ │"
  - rule_196.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7193-L7193) "│ │ rule_196.pdf │ │"
  - rule_193.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7195-L7195) "│ │ rule_193.pdf │ │"
  - contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7507-L7507) "│ contract.pdf • 245 KB • Uploaded Nov 15, 2024 │"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8672-L8672) "└─ Apply reference.docx styles"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8686-L8686) "└─ Run Pandoc: HTML → DOCX with reference.docx styles"
  - body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8688-L8688) "└─ Output: Temporary body.docx"
  - body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8691-L8691) "└─ Extract paragraphs from body.docx"
  - final.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8712-L8712) "└─ Save final.docx"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8828-L8828) "reference_doc: Path to reference.docx for styling"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9624-L9624) "doc = Document('reference.docx')"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9662-L9662) "convert_html_to_docx(body_html, Path('reference.docx'), body_docx_path)"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9793-L9793) "| 1 | Create document | reference.docx | Empty styled doc |"
  - body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9804-L9804) "| 9 | Pandoc conversion | HTML | Temp body.docx |"
  - body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9805-L9805) "| 10 | Merge body | Main doc + body.docx | Combined document |"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9812-L9812) "### 13.8 reference.docx Styles"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9814-L9814) "The reference.docx file defines all typography and formatting for the exported document. Pandoc applies these styles during conversion."
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9841-L9841) "1. Open reference.docx in **desktop Microsoft Word** (not online version)"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9857-L9857) "10. Save reference.docx"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9910-L9910) "**Complete reference.docx Creation Steps:**"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9914-L9914) "pandoc -o reference.docx --print-default-data-file reference.docx"
  - temp.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9973-L9973) "soffice --headless --convert-to pdf --outdir /tmp temp.docx"
  - requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10164-L10164) "# requirements.txt"
  - requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10192-L10192) "# requirements.txt"
  - service-pids.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10307-L10307) "private pidsFile = path.join(app.getPath('userData'), 'service-pids.json');"
  - response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10474-L10474) "const data = await response.json();"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10922-L10922) "│ │ ├── package.json"
  - tsconfig.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10924-L10924) "│ │ └── tsconfig.json"
  - requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10939-L10939) "│ │ ├── requirements.txt"
  - requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10951-L10951) "│ │ ├── requirements.txt"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10992-L10992) "│ │ ├── package.json"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11007-L11007) "│ │ ├── package.json"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11021-L11021) "│ │ └── package.json"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11028-L11028) "│ └── package.json"
  - docker-compose.dev.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11032-L11032) "│ │ ├── docker-compose.dev.yml # Local development"
  - docker-compose.cloud.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11033-L11033) "│ │ └── docker-compose.cloud.yml # Cloud deployment"
  - records-deployment.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11037-L11037) "│ │ │ ├── records-deployment.yaml"
  - ingestion-deployment.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11038-L11038) "│ │ │ ├── ingestion-deployment.yaml"
  - ingress.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11040-L11040) "│ │ ├── ingress.yaml"
  - secrets.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11041-L11041) "│ │ └── secrets.yaml"
  - build-config.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11044-L11044) "│ ├── build-config.json"
  - RUNBOOK_0.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11055-L11055) "│ │ ├── RUNBOOK_0.md # This specification"
  - RUNBOOK_1.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11056-L11056) "│ │ ├── RUNBOOK_1.md"
  - records-api.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11059-L11059) "│ ├── records-api.md"
  - ingestion-api.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11060-L11060) "│ ├── ingestion-api.md"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11063-L11063) "├── package.json # Root package.json (workspace)"
  - tsconfig.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11064-L11064) "├── tsconfig.json # Shared TypeScript config"
  - README.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11065-L11065) "└── README.md"
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11070-L11070) "**Root package.json:**"
  - docker-compose.dev.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11091-L11091) ""dev:services:docker": "docker-compose -f infrastructure/docker/docker-compose.dev.yml up","
  - package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11126-L11126) "├── package.json (requirements.txt)"
  - README.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11127-L11127) "└── README.md"
  - reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11320-L11320) "- [ ] `reference.docx` opens in Microsoft Word without errors"
  - purchase_agreement_2024.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11927-L11927) "│ purchase_agreement_2024.pdf │ ← Filename, monospace"
  - purchase_agreement_2024.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13989-L13989) "│ purchase_agreement_2024.pdf • 2.4 MB • Dec 10, 2024 │"
  - service-pids.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14452-L14452) "└── service-pids.json # PID tracking for zombie cleanup"
  - service-pids.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14463-L14463) "The `service-pids.json` file tracks all running service PIDs:"
  - ingestion-deployment.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14520-L14520) "# ingestion-deployment.yaml"
  - response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14608-L14608) "return response.json()"
  - res.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14713-L14713) "res.json(cases);"
  - response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14845-L14845) "return response.json()"
  - res.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14971-L14971) "res.json(health);"
  - motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15027-L15027) "✅ Upload motion.docx (3 per day)"
  - sample_motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15260-L15260) "### C.1 Sample Motion Content (sample_motion.docx)"
  - expected_parse.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15364-L15364) "### C.2 Expected Parse Output (expected_parse.json)"
  - sample_motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15366-L15366) "When sample_motion.docx is processed through the /ingest endpoint, the response should match this structure:"
  - sample_signature.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15458-L15458) "### C.3 Sample Signature Block (sample_signature.docx)"
  - sample_motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15492-L15492) "After processing sample_motion.docx through the full pipeline:"
- Process lifecycle (if any)
  - ``` ┌──────────────────────────────────────────────────────────────────┐ │  1. CREATE FROM SCRATCH                                          │ │     User opens Template Builder → configures all settings        │ │     → saves as new template                                      │ ├──────────────────────────────────────────────────────────────────┤ │  2. CREATE FROM UPLOAD                                           │ │     User uploads existing .docx → system extracts:               │ │     - Signature block (OOXML)                                    │ │     - Case block structure (suggests template)                   │ │     → User reviews/adjusts → saves as template                   │ ├──────────────────────────────────────────────────────────────────┤ │  3. DUPLICATE & MODIFY                                           │ │     User selects existing template → "Duplicate"                 │ │     → modifies settings → saves as new template                  │ ├──────────────────────────────────────────────────────────────────┤ │  4. EDIT EXISTING                                                │ │     User selects template → modifies → saves                     │ │     (Existing cases/drafts using this template inherit changes)  │ └──────────────────────────────────────────────────────────────────┘ ```

## Contracts Defined or Used
- REST POST /facts/parse (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1112-L1112) "2. Call Facts Service (`POST /facts/parse`) to get sentence IDs"
- REST PUT /drafts/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1115-L1115) "5. POST to Records Service (`PUT /drafts/{id}`)"
- REST GET /drafts/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1118-L1118) "1. GET from Records Service (`GET /drafts/{id}`)"
- REST POST /ingest (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6489-L6489) "### 10.1 POST /ingest"
- REST POST /export (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6516-L6516) "### 10.2 POST /export"
- REST POST /preview (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6608-L6608) "### 10.3 POST /preview"
- REST GET /health (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6681-L6681) "### 10.4 GET /health"
- REST POST /templates (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11352-L11352) "- [ ] `POST /templates` creates template, returns UUID"
- REST GET /templates/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11353-L11353) "- [ ] `GET /templates/{id}` retrieves template"
- REST PUT /templates/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11354-L11354) "- [ ] `PUT /templates/{id}` updates template"
- REST DELETE /templates/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11355-L11355) "- [ ] `DELETE /templates/{id}` soft-deletes template"
- REST POST /ingest (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11360-L11360) "- [ ] `POST /ingest` accepts .docx file"
- REST POST /export (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11366-L11366) "- [ ] `POST /export` accepts LegalDocument"
- REST POST /caseblock/extract (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11375-L11375) "- [ ] `POST /caseblock/extract` accepts raw OOXML"
- REST POST /caseblock/format (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11377-L11377) "- [ ] `POST /caseblock/format` accepts CaseCaption"
- REST POST /signature/extract (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11381-L11381) "- [ ] `POST /signature/extract` accepts raw OOXML"
- REST POST /signature/format (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11383-L11383) "- [ ] `POST /signature/format` accepts SignatureBlock"
- REST POST /facts/parse (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11387-L11387) "- [ ] `POST /facts/parse` accepts paragraph text"
- REST GET /facts/sentences/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11392-L11392) "- [ ] `GET /facts/sentences/{id}` retrieves sentence by ID"
- REST POST /exhibits (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11395-L11395) "- [ ] `POST /exhibits` uploads file, returns Exhibit with UUID"
- REST GET /exhibits/{id} (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11396-L11396) "- [ ] `GET /exhibits/{id}` retrieves exhibit metadata"
- REST POST /exhibits/appendix (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11397-L11397) "- [ ] `POST /exhibits/appendix` generates exhibit appendix OOXML"
- REST POST /caselaw/detect (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11402-L11402) "- [ ] `POST /caselaw/detect` accepts paragraph text"
- REST POST /caselaw/link (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11405-L11405) "- [ ] `POST /caselaw/link` accepts citation + opinion file, returns CaselawCitation"
- IPC | Runbook | Service | Port | Produces | Depends On | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L184-L184) "| Runbook | Service | Port | Produces | Depends On |"
- IPC - Facts Service (port 3006) is authoritative for sentence registry (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L313-L313) "- Facts Service (port 3006) is authoritative for sentence registry"
- IPC python main.py  # Runs on assigned port (e.g., 3001) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L348-L348) "python main.py # Runs on assigned port (e.g., 3001)"
- IPC ├── Records Service (port 3001) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L434-L434) "├── Records Service (port 3001)"
- IPC ├── Ingestion Service (port 3002) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L436-L436) "├── Ingestion Service (port 3002)"
- IPC ├── Export Service (port 3003) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L438-L438) "├── Export Service (port 3003)"
- IPC ├── CaseBlock Service (port 3004) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L440-L440) "├── CaseBlock Service (port 3004)"
- IPC ├── Signature Service (port 3005) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L442-L442) "├── Signature Service (port 3005)"
- IPC ├── Facts Service (port 3006) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L444-L444) "├── Facts Service (port 3006)"
- IPC ├── Exhibits Service (port 3007) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L446-L446) "├── Exhibits Service (port 3007)"
- IPC └── Caselaw Service (port 3008) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L448-L448) "└── Caselaw Service (port 3008)"
- IPC // Case Block Data (from CaseBlock Service, port 3004) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3132-L3132) "// Case Block Data (from CaseBlock Service, port 3004)"
- IPC // Signature Block Data (from Signature Service, port 3005) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3135-L3135) "// Signature Block Data (from Signature Service, port 3005)"
- IPC // Computed Metadata (from Facts Service, port 3006) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3146-L3146) "// Computed Metadata (from Facts Service, port 3006)"
- IPC // Exhibits (from Exhibits Service, port 3007) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3233-L3233) "// Exhibits (from Exhibits Service, port 3007)"
- IPC // Caselaw Citations (from Caselaw Service, port 3008) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3259-L3259) "// Caselaw Citations (from Caselaw Service, port 3008)"
- IPC // Statute Citations (from Caselaw Service, port 3008) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3285-L3285) "// Statute Citations (from Caselaw Service, port 3008)"
- IPC // Export Configuration (for Export Service, port 3003) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3308-L3308) "// Export Configuration (for Export Service, port 3003)"
- IPC 4. Update all services to handle missing field gracefully (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3460-L3460) "4. Update all services to handle missing field gracefully"
- IPC // Future: handle other citation types (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4404-L4404) "// Future: handle other citation types"
- IPC onKeyDown: (props) => { /* handle navigation */ }, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L5172-L5172) "onKeyDown: (props) => { /* handle navigation */ },"
- IPC | Ctrl+N | New window | New draft | Do NOT prevent—let browser handle. Use toolbar for new draft. | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7037-L7037) "| Ctrl+N | New window | New draft | Do NOT prevent—let browser handle. Use toolbar for new draft. |"
- IPC | Ctrl+O | Open file | Open draft | Do NOT prevent—let browser handle. Use toolbar for open. | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7038-L7038) "| Ctrl+O | Open file | Open draft | Do NOT prevent—let browser handle. Use toolbar for open. |"
- IPC const channel = new BroadcastChannel('factsway_editor'); (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7124-L7124) "const channel = new BroadcastChannel('factsway_editor');"
- IPC channel.postMessage({ type: 'DRAFT_OPENED', draftId: currentDraftId }); (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7127-L7127) "channel.postMessage({ type: 'DRAFT_OPENED', draftId: currentDraftId });"
- IPC channel.onmessage = (event) => { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7130-L7130) "channel.onmessage = (event) => {"
- IPC channel.postMessage({ type: 'DRAFT_CLOSED', draftId: currentDraftId }); (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7155-L7155) "channel.postMessage({ type: 'DRAFT_CLOSED', draftId: currentDraftId });"
- IPC While Pandoc 3.6.1+ can handle data URIs natively, preprocessing provides: (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9094-L9094) "While Pandoc 3.6.1+ can handle data URIs natively, preprocessing provides:"
- IPC # Log errors but continue - Pandoc will handle gracefully (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9198-L9198) "# Log errors but continue - Pandoc will handle gracefully"
- IPC **Records Service (port 3001)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10031-L10031) "**Records Service (port 3001)**"
- IPC PORT=3001 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10053-L10053) "PORT=3001"
- IPC **CaseBlock Service (port 3004)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10060-L10060) "**CaseBlock Service (port 3004)**"
- IPC PORT=3004 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10079-L10079) "PORT=3004"
- IPC **Signature Service (port 3005)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10087-L10087) "**Signature Service (port 3005)**"
- IPC **Facts Service (port 3006)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10105-L10105) "**Facts Service (port 3006)**"
- IPC **Exhibits Service (port 3007)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10123-L10123) "**Exhibits Service (port 3007)**"
- IPC **Caselaw Service (port 3008)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10141-L10141) "**Caselaw Service (port 3008)**"
- IPC **Ingestion Service (port 3002)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10162-L10162) "**Ingestion Service (port 3002)**"
- IPC PORT=3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10183-L10183) "PORT=3002"
- IPC **Export Service (port 3003)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10190-L10190) "**Export Service (port 3003)**"
- IPC PORT=3003 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10210-L10210) "PORT=3003"
- IPC port: number; (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10257-L10257) "port: number;"
- IPC port: 3001, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10268-L10268) "port: 3001,"
- IPC PORT: '3001', (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10270-L10270) "PORT: '3001',"
- IPC port: 3002, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10281-L10281) "port: 3002,"
- IPC PORT: '3002', (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10283-L10283) "PORT: '3002',"
- IPC port: 3003, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10294-L10294) "port: 3003,"
- IPC PORT: '3003', (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10296-L10296) "PORT: '3003',"
- IPC // Handle crashes (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10408-L10408) "// Handle crashes"
- IPC // Handle spawn errors (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10421-L10421) "// Handle spawn errors"
- IPC this.waitForServiceHealth(service.name, service.port) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10456-L10456) "this.waitForServiceHealth(service.name, service.port)"
- IPC private async waitForServiceHealth(name: string, port: number): Promise<void> { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10465-L10465) "private async waitForServiceHealth(name: string, port: number): Promise<void> {"
- IPC const url = `http://localhost:${port}/health`; (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10466-L10466) "const url = `http://localhost:${port}/health`;"
- IPC // Handle hard crashes (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10552-L10552) "// Handle hard crashes"
- IPC - [ ] `curl localhost:{port}/health` returns 200 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11333-L11333) "- [ ] `curl localhost:{port}/health` returns 200"
- IPC **Runbook 3: Records Service (port 3001)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11351-L11351) "**Runbook 3: Records Service (port 3001)**"
- IPC **Runbook 4: Ingestion Service (port 3002)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11359-L11359) "**Runbook 4: Ingestion Service (port 3002)**"
- IPC **Runbook 5: Export Service (port 3003)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11365-L11365) "**Runbook 5: Export Service (port 3003)**"
- IPC **Runbook 6: CaseBlock Service (port 3004)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11374-L11374) "**Runbook 6: CaseBlock Service (port 3004)**"
- IPC **Runbook 7: Signature Service (port 3005)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11380-L11380) "**Runbook 7: Signature Service (port 3005)**"
- IPC **Runbook 8: Facts Service (port 3006)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11386-L11386) "**Runbook 8: Facts Service (port 3006)**"
- IPC **Runbook 9: Exhibits Service (port 3007)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11394-L11394) "**Runbook 9: Exhibits Service (port 3007)**"
- IPC **Runbook 10: Caselaw Service (port 3008)** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11401-L11401) "**Runbook 10: Caselaw Service (port 3008)**"
- IPC **Pitfall 4: Service Port Conflicts** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11434-L11434) "**Pitfall 4: Service Port Conflicts**"
- IPC - **Cause:** Port collision between services (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11436-L11436) "- **Cause:** Port collision between services"
- IPC - [ ] Services use localhost:{port} (no Docker) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11492-L11492) "- [ ] Services use localhost:{port} (no Docker)"
- IPC - [ ] All service port numbers match Section 1.2 diagram (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11539-L11539) "- [ ] All service port numbers match Section 1.2 diagram"
- IPC 1. IDLE: Drag handle visible on hover (⠿ icon) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L12865-L12865) "1. IDLE: Drag handle visible on hover (⠿ icon)"
- IPC │ ⠿ I. INTRODUCTION       │  ← Drag handle on hover (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13599-L13599) "│ ⠿ I. INTRODUCTION │ ← Drag handle on hover"
- IPC .outline-item .drag-handle { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13636-L13636) ".outline-item .drag-handle {"
- IPC .outline-item:hover .drag-handle { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13642-L13642) ".outline-item:hover .drag-handle {"
- IPC This prevents "Port 3001 already in use" errors after crashes. (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14485-L14485) "This prevents "Port 3001 already in use" errors after crashes."
- IPC - name: PORT (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14542-L14542) "- name: PORT"
- IPC port: 3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14563-L14563) "port: 3002"
- IPC port: 3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14569-L14569) "port: 3002"
- IPC port: 3002 (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14583-L14583) "port: 3002"
- IPC port: parseInt(process.env.PORT || '3001'), (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14768-L14768) "port: parseInt(process.env.PORT || '3001'),"
- IPC port: int = int(os.getenv('PORT', '3002')) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14811-L14811) "port: int = int(os.getenv('PORT', '3002'))"
- IPC PORT: service.port.toString(), (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14857-L14857) "PORT: service.port.toString(),"
- IPC - name: PORT (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14928-L14928) "- name: PORT"
- IPC port: config.port, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14953-L14953) "port: config.port,"
- IPC "port": 3002, (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14984-L14984) ""port": 3002,"
- IPC **No Docker requirement for end users. No zombie processes. No port conflicts.** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15174-L15174) "**No Docker requirement for end users. No zombie processes. No port conflicts.**"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L18-L18) "4. [LegalDocument Schema](#4-legaldocument-schema-canonical-backend-contract)"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L44-L44) "- [21.2 Pipeline Event Schema](#212-pipeline-event-schema)"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L45-L45) "- [21.3 Invariant Result Schema](#213-invariant-result-schema)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L105-L105) "│ LegalDocument (Backend) │"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L132-L132) "│ - LegalDocument schema (Section 4) │"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L141-L141) "2. **Schema Contract:** All services communicate via LegalDocument schema (Section 4)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L143-L143) "4. **Frontend Transformation:** React app transforms Tiptap JSON ↔ LegalDocument"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L178-L178) "| 1 | Shared Infrastructure | LegalDocument schema, shared types, validation utilities | 0 |"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L188-L188) "| 5 | Export Service | 3003 | LegalDocument → DOCX pipeline, OOXML merger | 0, 1, 2 |"
- Schema interface that (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L196-L196) "Build the React-based user interface that orchestrates service calls."
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L220-L220) "7. **Schema compliance:** All services use LegalDocument schema defined in Section 4"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L231-L231) "- **Clean contracts:** LegalDocument schema (Section 4) prevents architectural drift"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L240-L240) "#### ADR-001: Dual Storage Model (LegalDocument + Tiptap)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L243-L243) "1. **LegalDocument schema** (Section 4) - Canonical storage in backend services"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L247-L247) "- LegalDocument provides stable structure for export pipeline and cross-service communication"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L249-L249) "- Clear boundary prevents schema pollution (UI concerns don't leak into storage layer)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L252-L252) "- Frontend must transform LegalDocument ↔ Tiptap on load/save"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L262-L262) "Frontend (Tiptap): Backend (LegalDocument):"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L281-L281) "- Exhibit labels are computed from LegalDocument.exhibits array"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L284-L284) "#### ADR-003: Microservices Communication via LegalDocument Schema"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L286-L286) "**Decision:** All backend services accept and return LegalDocument schema (Section 4). No service-specific schemas."
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L289-L289) "- Single source of truth prevents schema drift"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L294-L294) "- Services must validate incoming LegalDocument"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L295-L295) "- New fields require schema version bump"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L296-L296) "- Frontend API client layer transforms Tiptap → LegalDocument before POST"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L383-L383) "- Phase 1: Schema validation tests pass"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L395-L395) "3. Backend implements endpoint + passes schema validation"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L437-L437) "│ └── DOCX → LegalDocument parsing"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L439-L439) "│ └── LegalDocument → DOCX generation"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L657-L657) "### 2.2 Template Schema"
- Schema interface Template (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L660-L660) "interface Template {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L686-L686) "// Outline Schema (Section Hierarchy)"
- Schema interface TemplateVariable (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L712-L712) "interface TemplateVariable {"
- Schema interface VariableComputation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L725-L725) "interface VariableComputation {"
- Schema interface PartyBlockConfig (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L742-L742) "interface PartyBlockConfig {"
- Schema interface PartyGroupConfig (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L747-L747) "interface PartyGroupConfig {"
- Schema interface VariableMarker (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L754-L754) "interface VariableMarker {"
- Schema interface OutlineSchema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L761-L761) "interface OutlineSchema {"
- Schema interface OutlineLevel (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L767-L767) "interface OutlineLevel {"
- Schema interface HeadingStyle (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L776-L776) "interface HeadingStyle {"
- Schema interface FooterConfig (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L783-L783) "interface FooterConfig {"
- Schema interface TypographyConfig (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L799-L799) "interface TypographyConfig {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L830-L830) "### 2.3 Case Schema"
- Schema interface Case (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L833-L833) "interface Case {"
- Schema interface Evidence (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L886-L886) "interface Evidence {"
- Schema interface PartyGroup (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L915-L915) "interface PartyGroup {"
- Schema interface Party (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L921-L921) "interface Party {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L948-L948) "### 2.4 Draft Schema"
- Schema interface Draft (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L951-L951) "interface Draft {"
- Schema interface SentenceRegistry (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L996-L996) "interface SentenceRegistry {"
- Schema interface ParagraphSentences (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1002-L1002) "interface ParagraphSentences {"
- Schema interface Sentence (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1007-L1007) "interface Sentence {"
- Schema interface SectionNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1021-L1021) "interface SectionNode {"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1024-L1024) "number: string; // "I", "A", "1" - computed from outline schema"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1030-L1030) "// Section numbers are computed based on position and outline schema."
- Schema interface ExportRecord (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1033-L1033) "interface ExportRecord {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1040-L1040) "### 2.5 Dual Storage Model (LegalDocument + Tiptap)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1044-L1044) "1. **LegalDocument schema** (Section 4) - Canonical storage, backend services"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1049-L1049) "- **LegalDocument** provides stable, versioned structure for export and service communication"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1051-L1051) "- Clear separation prevents UI concerns from polluting storage schema"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1087-L1087) "│ LegalDocument (Section 4): │"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1114-L1114) "4. Build LegalDocument with sentences + exhibits arrays"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1119-L1119) "2. Receive LegalDocument with sentences array"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1126-L1126) "| Feature | Tiptap (Frontend) | LegalDocument (Backend) |"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1136-L1136) "#### Tiptap Schema (Frontend Only)"
- Schema interface TiptapDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1139-L1139) "interface TiptapDocument {"
- Schema type BlockNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1144-L1144) "type BlockNode ="
- Schema interface ParagraphNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1152-L1152) "interface ParagraphNode {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1155-L1155) "sentenceId?: string; // Preserved from LegalDocument for evidence linking"
- Schema interface HeadingNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1160-L1160) "interface HeadingNode {"
- Schema type InlineNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1168-L1168) "type InlineNode ="
- Schema interface TextNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1176-L1176) "interface TextNode {"
- Schema interface Mark (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1182-L1182) "interface Mark {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1200-L1200) "Frontend (Tiptap): Backend (LegalDocument):"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1211-L1211) "**When user saves:** CitationNodes are converted to plain text ("Exhibit A") in LegalDocument.sentences[].text"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1213-L1213) "**When user loads:** Plain text is analyzed, CitationNodes are re-inserted based on LegalDocument.exhibits[] array"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1215-L1215) "#### CitationNode Schema (Tiptap Only)"
- Schema interface CitationNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1218-L1218) "interface CitationNode {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1269-L1269) "// On save, transforms to LegalDocument:"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1305-L1305) "// On save, transforms to LegalDocument (plain text only):"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1328-L1328) "- `LegalDocument.sentences[]` - Plain text with sentence IDs"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1329-L1329) "- `LegalDocument.exhibits[]` - Exhibit metadata"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1330-L1330) "- `LegalDocument.sentences[].evidence_links[]` - Sentence-to-evidence mappings"
- Schema interface CitationIndex (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1339-L1339) "interface CitationIndex {"
- Schema type EvidenceType (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1410-L1410) "type EvidenceType = 'exhibit' | 'caselaw' | 'statute';"
- Schema type from (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1412-L1412) "// Note: This is the same as Evidence.type from Section 2.3"
- Schema interface UnlinkedCitation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1415-L1415) "interface UnlinkedCitation {"
- Schema interface CrossReferenceNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L2482-L2482) "interface CrossReferenceNode {"
- Schema interface VariableNode (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L2640-L2640) "interface VariableNode {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L2767-L2767) "3. **Outline Schema Builder**"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3093-L3093) "## 4. LegalDocument Schema (Canonical Backend Contract)"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3095-L3095) "**CRITICAL:** This is the ONLY data structure that backend services (Runbooks 3-10) accept and return. All microservices MUST validate incoming payloads against this schema."
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3099-L3099) "LegalDocument provides a stable, versioned contract for:"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3101-L3101) "- Export pipeline (Export Service converts LegalDocument → DOCX)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3102-L3102) "- Storage (Records Service persists LegalDocument to database)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3103-L3103) "- API boundaries (Frontend sends/receives LegalDocument via REST)"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3105-L3105) "### 4.2 Schema Version"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3116-L3116) "### 4.3 Complete TypeScript Schema"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3119-L3119) "interface LegalDocument {"
- Schema interface LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3119-L3119) "interface LegalDocument {"
- Schema interface CaseCaption (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3157-L3157) "interface CaseCaption {"
- Schema interface Party (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3171-L3171) "interface Party {"
- Schema interface SignatureBlock (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3181-L3181) "interface SignatureBlock {"
- Schema interface Sentence (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3205-L3205) "interface Sentence {"
- Schema interface SentenceRegistry (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3221-L3221) "interface SentenceRegistry {"
- Schema interface RegistryParagraph (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3227-L3227) "interface RegistryParagraph {"
- Schema interface Exhibit (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3236-L3236) "interface Exhibit {"
- Schema interface CaselawCitation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3262-L3262) "interface CaselawCitation {"
- Schema interface StatuteCitation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3288-L3288) "interface StatuteCitation {"
- Schema interface ExportConfig (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3311-L3311) "interface ExportConfig {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3342-L3342) "**All services MUST validate incoming LegalDocument against these rules:**"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3378-L3378) "raise ValueError(f"Unsupported schema version: {v}")"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3386-L3386) "| Records (3001) | Full LegalDocument | Full LegalDocument | ✓ All fields |"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3388-L3388) "| Export (3003) | Full LegalDocument | - | ✓ Input only |"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3397-L3397) "**Rule:** Frontend MUST transform Tiptap JSON → LegalDocument before calling backend APIs."
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3403-L3403) "* Convert Tiptap JSON to LegalDocument"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3410-L3410) "): LegalDocument {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3420-L3420) "// 4. Build LegalDocument"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3434-L3434) "* Convert LegalDocument to Tiptap JSON"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3437-L3437) "static legalDocumentToTiptap(doc: LegalDocument): TiptapDocument {"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3455-L3455) "**When adding new fields to LegalDocument:**"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3466-L3466) "interface LegalDocument {"
- Schema interface LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3466-L3466) "interface LegalDocument {"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3599-L3599) "case_data: Case schema data (court, parties, cause_number, etc.)"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3600-L3600) "template: Template schema data (case_block configuration)"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3867-L3867) "Headings map to outline schema levels:"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3892-L3892) "- Renumber affected sections according to outline schema"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3911-L3911) "**IndexedDB Schema:**"
- Schema interface ImageStore (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3914-L3914) "interface ImageStore {"
- Schema interface CitationValidation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4617-L4617) "interface CitationValidation {"
- Schema interface CitationWarning (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4623-L4623) "interface CitationWarning {"
- Schema interface CitationError (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4630-L4630) "interface CitationError {"
- Schema type and (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4711-L4711) "The editor detects citation patterns as users type and offers to convert them to linked citations."
- Schema interface CitationMatch (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4972-L4972) "interface CitationMatch {"
- Schema interface VariableAttributes (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L5126-L5126) "export interface VariableAttributes {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L5362-L5362) "### 7.1 Outline Schema Configuration"
- Schema interface ParsedSection (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L5978-L5978) "interface ParsedSection {"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L5987-L5987) "// Conversion: Generate stable UUID for id, compute number from position and outline schema."
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6013-L6013) "# Compute number based on position and outline schema"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6054-L6054) """"Convert index to formatted number based on outline schema format.""""
- Schema interface ParsedDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6132-L6132) "interface ParsedDocument {"
- Schema interface FormatMark (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6173-L6173) "interface FormatMark {"
- Schema interface FormattedParagraph (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6179-L6179) "interface FormattedParagraph {"
- Schema interface PreservationMetadata (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6334-L6334) "interface PreservationMetadata {"
- Schema type and (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6734-L6734) "- Error type and stage"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6790-L6790) "│ ○ Outline Schema │ Example for "Outline Schema" tab: │"
- Schema interface Toast (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6899-L6899) "interface Toast {"
- Schema interface ConfirmDialog (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6978-L6978) "interface ConfirmDialog {"
- Schema interface EvidenceSidebarProps (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7209-L7209) "interface EvidenceSidebarProps {"
- Schema type EvidenceType (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7218-L7218) "type EvidenceType = 'exhibit' | 'caselaw' | 'statute';"
- Schema interface EvidenceMapData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7677-L7677) "interface EvidenceMapData {"
- Schema interface SupportedClaim (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7684-L7684) "interface SupportedClaim {"
- Schema interface UnsupportedClaim (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7696-L7696) "interface UnsupportedClaim {"
- Schema interface UnlinkedCitation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7702-L7702) "interface UnlinkedCitation {"
- Schema interface CitationPosition (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7924-L7924) "interface CitationPosition {"
- Schema interface ImportOptions (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8459-L8459) "interface ImportOptions {"
- Schema interface ImportResult (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8532-L8532) "interface ImportResult {"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8682-L8682) "└─ Apply outline schema numbering to headings"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9655-L9655) "# Step 6: Apply outline schema numbering to headings"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9705-L9705) "Apply outline schema numbering to headings in the HTML."
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9801-L9801) "| 6 | Apply section numbering | HTML + Outline schema | Numbered HTML |"
- Schema zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10038-L10038) ""zod": "^3.22.4","
- Schema zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10066-L10066) ""zod": "^3.22.4","
- Schema zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10093-L10093) ""zod": "^3.22.4""
- Schema zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10111-L10111) ""zod": "^3.22.4""
- Schema zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10129-L10129) ""zod": "^3.22.4""
- Schema zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10148-L10148) ""zod": "^3.22.4""
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10176-L10176) "- Parse DOCX to LegalDocument"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10203-L10203) "- Generate DOCX from LegalDocument"
- Schema interface ServiceConfig (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10253-L10253) "interface ServiceConfig {"
- Schema interface CaseRepository (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10790-L10790) "interface CaseRepository {"
- Schema Zod (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11023-L11023) "│ └── shared-validation/ # Zod schemas"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11025-L11025) "│ │ ├── template.schema.ts"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11026-L11026) "│ │ ├── case.schema.ts"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11313-L11313) "- [ ] `npm run validate-schema` passes (validates LegalDocument TypeScript schema)"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11314-L11314) "- [ ] `python -m pytest tests/schema/test_legal_document.py` passes (Pydantic validation)"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11316-L11316) "- [ ] Schema version is "1.0.0" in all files"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11336-L11336) "**Schema Validation:**"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11337-L11337) "- [ ] Service rejects invalid LegalDocument (wrong schema_version)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11361-L11361) "- [ ] Returns LegalDocument with sentences[], case_caption, signature_block"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11366-L11366) "- [ ] `POST /export` accepts LegalDocument"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11410-L11410) "**Pitfall 1: Schema Drift**"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11411-L11411) "- **Symptom:** Service A sends LegalDocument, Service B rejects it"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11412-L11412) "- **Cause:** Services using different schema versions"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11414-L11414) "- All services MUST import schema from `shared/schemas/legal_document.py`"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11415-L11415) "- CI/CD pipeline validates schema consistency across services"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11428-L11428) "- **Cause:** Frontend sent Tiptap JSON instead of LegalDocument"
- Schema schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11431-L11431) "- Backend schema validation rejects unknown node types"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11442-L11442) "**Pitfall 5: Missing Schema Validation**"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11444-L11444) "- **Cause:** Service accepts invalid LegalDocument"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11470-L11470) "- [ ] Tiptap → LegalDocument transform works (CitationNode → plain text)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11471-L11471) "- [ ] LegalDocument → Tiptap transform works (plain text → CitationNode)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11531-L11531) "- [ ] Section 1.2 references Section 4 (LegalDocument Schema)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11533-L11533) "- [ ] Section 1.5 ADR-001 references Section 4 (LegalDocument Schema)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11535-L11535) "- [ ] Section 1.5 ADR-003 references Section 4 (LegalDocument Schema) and Section 11 (API)"
- Schema LegalDocument (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11537-L11537) "- [ ] Section 2.5 references Section 4 (LegalDocument Schema)"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11545-L11545) "- [ ] Schema migrations run successfully"
- Schema type icon (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11925-L11925) "│ 📎 Exhibit A - Purchase Agreement │ ← Title with type icon"
- Schema type indicator (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L12085-L12085) "| Pro Se | #fef3c7 | #fcd34d | #b45309 | Filer type indicator |"
- Schema type indicator (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L12086-L12086) "| Attorney | #e0e7ff | #c7d2fe | #4338ca | Filer type indicator |"
- Schema interface with (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L12608-L12608) "The primary drafting interface with outline, document, and evidence panels."
- Schema interface CasesViewData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13317-L13317) "interface CasesViewData {"
- Schema interface TemplatesViewData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13400-L13400) "interface TemplatesViewData {"
- Schema interface VaultViewData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13514-L13514) "interface VaultViewData {"
- Schema interface DraftingEditorData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13716-L13716) "interface DraftingEditorData {"
- Schema interface CaseBlockGeneratorData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13824-L13824) "interface CaseBlockGeneratorData {"
- Schema interface ExportPreviewData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13923-L13923) "interface ExportPreviewData {"
- Schema interface DocumentViewerData (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14026-L14026) "interface DocumentViewerData {"
- Schema interface EvidenceMapPanelProps (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14112-L14112) "interface EvidenceMapPanelProps {"
- Schema interface DisplayEvidence (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14118-L14118) "interface DisplayEvidence {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14169-L14169) "### 20.2 Pipeline Event Schema"
- Schema interface PipelineEvent (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14173-L14173) "interface PipelineEvent {"
- Schema Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14200-L14200) "### 20.3 Invariant Result Schema"
- Schema interface InvariantResult (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14204-L14204) "interface InvariantResult {"
- Schema interface Draft (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14257-L14257) "interface Draft {"
- Schema interface PipelineRun (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14267-L14267) "interface PipelineRun {"
- Schema interface TraceQueries (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14356-L14356) "interface TraceQueries {"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L179-L179) "| 2 | Document Processing Core | OOXML generators, Pandoc wrapper, reference.docx | 0, 1 |"
- File requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L347-L347) "pip install -r requirements.txt"
- File docker-compose.test.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L373-L373) "docker-compose -f docker-compose.test.yml up --abort-on-container-exit"
- File api-spec.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L393-L393) "1. Define endpoint in `api-spec.yaml` (Section 11)"
- File motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L519-L519) "- Upload motion.docx in browser"
- File response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L593-L593) "const result = await response.json();"
- File response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L608-L608) "const result = await response.json();"
- File smith_v_jones_opinion.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L897-L897) "name: string; // "smith_v_jones_opinion.pdf""
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1100-L1100) "│ file_path: "/uploads/contract.pdf" │"
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1275-L1275) "{ id: 'ev-001', label: 'A', file_path: '/uploads/contract.pdf' }"
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3241-L3241) "file_name: string; // "contract.pdf""
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3242-L3242) "file_path: string; // "/uploads/{case_id}/exhibits/contract.pdf""
- File smith_v_jones.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3278-L3278) "opinion_file_path?: string; // "/uploads/{case_id}/opinions/smith_v_jones.pdf""
- File cprc_41.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L3301-L3301) "statute_file_path?: string; // "/uploads/{case_id}/statutes/cprc_41.pdf""
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4476-L4476) "│ contract.pdf (245 KB) │"
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4545-L4545) "│ │ ○ Exhibit A - Signed Contract (contract.pdf) │ │"
- File emails.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4546-L4546) "│ │ ○ Exhibit B - Email Correspondence (emails.pdf) │ │"
- File invoice.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4547-L4547) "│ │ ○ Exhibit C - Invoice #1234 (invoice.pdf) │ │"
- File smith_v_jones.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4799-L4799) "│ ○ Smith v. Jones opinion (smith_v_jones.pdf) │"
- File doe_v_state.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L4800-L4800) "│ ○ Doe v. State opinion (doe_v_state.pdf) │"
- File original.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6408-L6408) "doc = Document("original.docx")"
- File exported.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6419-L6419) "new_doc.save("exported.docx")"
- File exported.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6422-L6422) "reloaded = Document("exported.docx")"
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7173-L7173) "│ │ contract.pdf • 245 KB │ │"
- File emails.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7175-L7175) "│ │ emails.pdf • 1.2 MB │ │"
- File invoice.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7177-L7177) "│ │ invoice.pdf • 89 KB │ │"
- File opinion.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7184-L7184) "│ │ 123 S.W.3d 456 • opinion.pdf │ │"
- File doe_opinion.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7186-L7186) "│ │ 456 S.W.3d 789 • doe_opinion.pdf │ │"
- File rule_196.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7193-L7193) "│ │ rule_196.pdf │ │"
- File rule_193.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7195-L7195) "│ │ rule_193.pdf │ │"
- File contract.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L7507-L7507) "│ contract.pdf • 245 KB • Uploaded Nov 15, 2024 │"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8672-L8672) "└─ Apply reference.docx styles"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8686-L8686) "└─ Run Pandoc: HTML → DOCX with reference.docx styles"
- File body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8688-L8688) "└─ Output: Temporary body.docx"
- File body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8691-L8691) "└─ Extract paragraphs from body.docx"
- File final.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8712-L8712) "└─ Save final.docx"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L8828-L8828) "reference_doc: Path to reference.docx for styling"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9624-L9624) "doc = Document('reference.docx')"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9662-L9662) "convert_html_to_docx(body_html, Path('reference.docx'), body_docx_path)"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9793-L9793) "| 1 | Create document | reference.docx | Empty styled doc |"
- File body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9804-L9804) "| 9 | Pandoc conversion | HTML | Temp body.docx |"
- File body.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9805-L9805) "| 10 | Merge body | Main doc + body.docx | Combined document |"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9812-L9812) "### 13.8 reference.docx Styles"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9814-L9814) "The reference.docx file defines all typography and formatting for the exported document. Pandoc applies these styles during conversion."
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9841-L9841) "1. Open reference.docx in **desktop Microsoft Word** (not online version)"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9857-L9857) "10. Save reference.docx"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9910-L9910) "**Complete reference.docx Creation Steps:**"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9914-L9914) "pandoc -o reference.docx --print-default-data-file reference.docx"
- File temp.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9973-L9973) "soffice --headless --convert-to pdf --outdir /tmp temp.docx"
- File requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10164-L10164) "# requirements.txt"
- File requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10192-L10192) "# requirements.txt"
- File service-pids.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10307-L10307) "private pidsFile = path.join(app.getPath('userData'), 'service-pids.json');"
- File response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10474-L10474) "const data = await response.json();"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10922-L10922) "│ │ ├── package.json"
- File tsconfig.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10924-L10924) "│ │ └── tsconfig.json"
- File requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10939-L10939) "│ │ ├── requirements.txt"
- File requirements.txt (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10951-L10951) "│ │ ├── requirements.txt"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10992-L10992) "│ │ ├── package.json"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11007-L11007) "│ │ ├── package.json"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11021-L11021) "│ │ └── package.json"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11028-L11028) "│ └── package.json"
- File docker-compose.dev.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11032-L11032) "│ │ ├── docker-compose.dev.yml # Local development"
- File docker-compose.cloud.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11033-L11033) "│ │ └── docker-compose.cloud.yml # Cloud deployment"
- File records-deployment.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11037-L11037) "│ │ │ ├── records-deployment.yaml"
- File ingestion-deployment.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11038-L11038) "│ │ │ ├── ingestion-deployment.yaml"
- File ingress.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11040-L11040) "│ │ ├── ingress.yaml"
- File secrets.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11041-L11041) "│ │ └── secrets.yaml"
- File build-config.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11044-L11044) "│ ├── build-config.json"
- File RUNBOOK_0.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11055-L11055) "│ │ ├── RUNBOOK_0.md # This specification"
- File RUNBOOK_1.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11056-L11056) "│ │ ├── RUNBOOK_1.md"
- File records-api.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11059-L11059) "│ ├── records-api.md"
- File ingestion-api.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11060-L11060) "│ ├── ingestion-api.md"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11063-L11063) "├── package.json # Root package.json (workspace)"
- File tsconfig.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11064-L11064) "├── tsconfig.json # Shared TypeScript config"
- File README.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11065-L11065) "└── README.md"
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11070-L11070) "**Root package.json:**"
- File docker-compose.dev.yml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11091-L11091) ""dev:services:docker": "docker-compose -f infrastructure/docker/docker-compose.dev.yml up","
- File package.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11126-L11126) "├── package.json (requirements.txt)"
- File README.md (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11127-L11127) "└── README.md"
- File reference.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11320-L11320) "- [ ] `reference.docx` opens in Microsoft Word without errors"
- File purchase_agreement_2024.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11927-L11927) "│ purchase_agreement_2024.pdf │ ← Filename, monospace"
- File purchase_agreement_2024.pdf (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L13989-L13989) "│ purchase_agreement_2024.pdf • 2.4 MB • Dec 10, 2024 │"
- File service-pids.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14452-L14452) "└── service-pids.json # PID tracking for zombie cleanup"
- File service-pids.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14463-L14463) "The `service-pids.json` file tracks all running service PIDs:"
- File ingestion-deployment.yaml (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14520-L14520) "# ingestion-deployment.yaml"
- File response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14608-L14608) "return response.json()"
- File res.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14713-L14713) "res.json(cases);"
- File response.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14845-L14845) "return response.json()"
- File res.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14971-L14971) "res.json(health);"
- File motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15027-L15027) "✅ Upload motion.docx (3 per day)"
- File sample_motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15260-L15260) "### C.1 Sample Motion Content (sample_motion.docx)"
- File expected_parse.json (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15364-L15364) "### C.2 Expected Parse Output (expected_parse.json)"
- File sample_motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15366-L15366) "When sample_motion.docx is processed through the /ingest endpoint, the response should match this structure:"
- File sample_signature.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15458-L15458) "### C.3 Sample Signature Block (sample_signature.docx)"
- File sample_motion.docx (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15492-L15492) "After processing sample_motion.docx through the full pipeline:"

## Invariants Relied On
- - [21.3 Invariant Result Schema](#213-invariant-result-schema) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L45-L45) "- [21.3 Invariant Result Schema](#213-invariant-result-schema)"
- - [21.6 Invariant Definitions by Domain](#216-invariant-definitions-by-domain) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L48-L48) "- [21.6 Invariant Definitions by Domain](#216-invariant-definitions-by-domain)"
- ### 20.3 Invariant Result Schema (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14200-L14200) "### 20.3 Invariant Result Schema"
- Each invariant check produces an `InvariantResult`: (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14202-L14202) "Each invariant check produces an `InvariantResult`:"
- invariant: string; (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14280-L14280) "invariant: string;"
- ### 20.6 Invariant Definitions by Domain (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14288-L14288) "### 20.6 Invariant Definitions by Domain"
- | Invariant | Check | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14292-L14292) "| Invariant | Check |"
- | Invariant | Check | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14301-L14301) "| Invariant | Check |"
- | Invariant | Check | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14310-L14310) "| Invariant | Check |"
- | Invariant | Check | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14318-L14318) "| Invariant | Check |"
- | Invariant | Check | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14326-L14326) "| Invariant | Check |"
- When an invariant fails: (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14334-L14334) "When an invariant fails:"
- | Invariant Type | Default Severity | (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14344-L14344) "| Invariant Type | Default Severity |"
- - WARNING invariant failures trigger `warning` toast (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14387-L14387) "- WARNING invariant failures trigger `warning` toast"
- - Each invariant should have unit tests with passing and failing cases (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14403-L14403) "- Each invariant should have unit tests with passing and failing cases"

## Verification Gate (Commands + Expected Outputs)
- pytest tests/unit/ (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L368-L368) "pytest tests/unit/"
- Ask LLM to verify a single sentence boundary. (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1715-L1715) "Ask LLM to verify a single sentence boundary."
- Verify each low-confidence boundary with a surgical LLM call. (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1779-L1779) "Verify each low-confidence boundary with a surgical LLM call."
- # 5. Verify match (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L6425-L6425) "# 5. Verify match"
- # Verify (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9065-L9065) "# Verify"
- # Verify target doc has footnotes part (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9070-L9070) "# Verify target doc has footnotes part"
- # Verify footnote count (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L9073-L9073) "# Verify footnote count"
- npm test  # Jest + Supertest (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L10877-L10877) "npm test # Jest + Supertest"
- - [ ] `python -m pytest tests/schema/test_legal_document.py` passes (Pydantic validation) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11314-L11314) "- [ ] `python -m pytest tests/schema/test_legal_document.py` passes (Pydantic validation)"
- - [ ] `python -m pytest tests/ooxml/` passes (OOXML generators) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11323-L11323) "- [ ] `python -m pytest tests/ooxml/` passes (OOXML generators)"
- - [ ] `python -m pytest tests/pandoc/` passes (Pandoc wrapper) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11324-L11324) "- [ ] `python -m pytest tests/pandoc/` passes (Pandoc wrapper)"
- **For EACH microservice, verify:** (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11329-L11329) "**For EACH microservice, verify:**"
- - [ ] `pytest tests/unit/` passes (95%+ coverage) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11342-L11342) "- [ ] `pytest tests/unit/` passes (95%+ coverage)"
- - [ ] `pytest tests/integration/` passes (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11346-L11346) "- [ ] `pytest tests/integration/` passes"
- - Verify ID preservation algorithm with unit tests (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11423-L11423) "- Verify ID preservation algorithm with unit tests"
- - Integration tests verify frontend → backend transformation (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11432-L11432) "- Integration tests verify frontend → backend transformation"
- 5. [ ] Verify Ingestion Service extracted case data correctly (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11510-L11510) "5. [ ] Verify Ingestion Service extracted case data correctly"
- 11. [ ] Save draft (verify auto-save indicator) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11516-L11516) "11. [ ] Save draft (verify auto-save indicator)"
- 14. [ ] Verify formatting: fonts, spacing, margins, section numbers (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11519-L11519) "14. [ ] Verify formatting: fonts, spacing, margins, section numbers"
- 15. [ ] Verify case caption: centered, caps, bold (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11520-L11520) "15. [ ] Verify case caption: centered, caps, bold"
- 16. [ ] Verify signature block: left-aligned, proper spacing (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11521-L11521) "16. [ ] Verify signature block: left-aligned, proper spacing"
- 17. [ ] Verify footer: motion title + page numbers (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11522-L11522) "17. [ ] Verify footer: motion title + page numbers"
- 18. [ ] Verify exhibit appendix: exhibit A attached (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11523-L11523) "18. [ ] Verify exhibit appendix: exhibit A attached"
- 19. [ ] Close and re-open draft (verify load from Records Service) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11524-L11524) "19. [ ] Close and re-open draft (verify load from Records Service)"
- 20. [ ] Verify sentence IDs preserved (evidence links still work) (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11525-L11525) "20. [ ] Verify sentence IDs preserved (evidence links still work)"
- After all edits, verify cross-references are correct: (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L11529-L11529) "After all edits, verify cross-references are correct:"
- - Pipeline tests should verify correct events are emitted (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14404-L14404) "- Pipeline tests should verify correct events are emitted"
- jwt.verify(token, getKey, { (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L14680-L14680) "jwt.verify(token, getKey, {"
- These sample documents provide exact content for testing the entire pipeline. Use them to verify parsing, editing, and export functionality. (Source: 00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L15258-L15258) "These sample documents provide exact content for testing the entire pipeline. Use them to verify parsing, editing, and export functionality."

## Risks / Unknowns (TODOs)
UNSPECIFIED
TODO: Document risks (00_RUNBOOK_0_CONTRACT_DEFINITION_FINAL.md:L1-L15528)
